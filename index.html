        options: [
          { text: "Já tentei, mas não adiantou", next: 3 },
          { text: "Nunca tentei, sigo estudando do meu jeito", next: 3 },
        ],
      },
      // STEP 3: Planejamento
      {
        id: 3,
        question: "Hoje você segue um planejamento claro de estudos? (ex: ciclo, rotina fixa, metas semanais)",
        options: [
          { text: "Tenho um plano estruturado", next: 4 },
          { text: "Faço mais ou menos, sem rotina definida", next: 4 },
          { text: "Não, estudo totalmente solto", next: 4 },
        ],
      },
      // STEP 4: Revisão
      {
        id: 4,
        question: "Você tem um método de revisão que funciona de verdade? (Ou sente que esquece muito rápido?)",
        options: [
          { text: "Sim, reviso bem", next: 5 },
          { text: "Faço revisão, mas sinto que esqueço rápido", next: 5 },
          { text: "Não reviso quase nada", next: 5 },
        ],
      },
      // STEP 5: Questões
      {
        id: 5,
        question: "Resolver questões faz parte do seu dia a dia?",
        options: [
          { text: "Sim, todo dia", next: 6 },
          { text: "Só quando sobra tempo", next: 6 },
          { text: "Raramente", next: 6 },
        ],
      },
      // STEP 6: Material
      {
        id: 6,
        question: "Você sente segurança ao escolher materiais de estudo? (PDF, videoaula, site de questões etc)",
        options: [
          { text: "Sim, sei escolher", next: 7 },
          { text: "Não, sempre fico na dúvida", next: 7 },
        ],
      },
      // STEP 7: Área de foco
      {
        id: 7,
        question: "Você já escolheu a área/cargo que quer? Ou ainda está testando tudo?",
        options: [
          { text: "Já sei meu foco", next: 8 },
          { text: "Ainda não, estou perdido(a)", next: 8 },
        ],
      },
      // STEP 8: Diagnóstico personalizado
      {
        id: 8,
        question: (state) => {
          // Diagnóstico dinâmico com base no que respondeu
          let problemas = [];
          if (state[1] === 0) problemas.push("falta de evolução nos estudos");
          if (state[3] !== 0) problemas.push("ausência de planejamento estruturado");
          if (state[4] !== 0) problemas.push("revisão pouco eficaz ou inexistente");
          if (state[5] !== 0) problemas.push("baixa prática com questões");
          if (state[6] !== 0) problemas.push("insegurança na escolha de materiais");
          if (state[7] !== 0) problemas.push("falta de clareza sobre o foco");
          const nome = state.nome || "Concurseiro(a)";
          return `
            <strong>${nome}, veja seu diagnóstico:</strong>
            <br><br>
            Você enfrenta:<br>
            <ul>
              ${problemas.map(p => `<li>• ${p}</li>`).join('')}
            </ul>
            <br>
            <b>É justamente para vencer essas barreiras que existe o Manual do Aprovado — Versão do Iniciante.</b>
            <br><br>
            Quer entender como o Manual pode resolver seu caso?
          `;
        },
        options: [
          { text: "Quero ver o método!", next: 9 },
          { text: "Voltar ao início", next: 1 }
        ]
      },
      // STEP 9: Apresentação do Manual
      {
        id: 9,
        question: `
        <strong>Como o Manual do Aprovado vai te ajudar:</strong>
        <ul>
          <li>✔️ Método validado, direto ao ponto</li>
          <li>✔️ Ciclo de estudos explicado com modelos práticos</li>
          <li>✔️ Estratégia de revisão simples e eficiente</li>
          <li>✔️ Como usar questões para consolidar o estudo</li>
          <li>✔️ Guia de materiais e áreas de foco</li>
          <li>✔️ Tudo para evitar os erros que você acabou de relatar</li>
        </ul>
        <br>
        <b>Bônus:</b> Suporte personalizado, dicas exclusivas e atualização para 2025.<br><br>
        <a href="https://wa.me/SEUNUMERO" class="cta-final" target="_blank">QUERO GARANTIR O MEU MANUAL!</a>
        `,
        options: [
          { text: "Voltar ao diagnóstico", next: 8 }
        ]
      },
      // STEP 10: Caso o usuário já esteja progredindo bem
      {
        id: 10,
        question: "Você já foi aprovado em algum concurso? Ou está estudando para sua primeira prova?",
        options: [
          { text: "Já fui aprovado", next: 11 },
          { text: "Ainda não, mas estou confiante", next: 12 }
        ]
      },
      // STEP 11: Parabenização (aprovados)
      {
        id: 11,
        question: (state) => `Parabéns, ${state.nome || "concurseiro(a)"}! Já passou por onde muitos querem chegar. Se quiser aperfeiçoar seu método, conhecer técnicas avançadas e acelerar novas aprovações, conheça o Manual do Aprovado.<br><br><a href="https://wa.me/SEUNUMERO" class="cta-final" target="_blank">QUERO ACESSAR!</a>`,
        options: [
          { text: "Voltar ao início", next: 1 }
        ]
      },
      // STEP 12: Incentivo para os confiantes
      {
        id: 12,
        question: (state) => `${state.nome || "Concurseiro(a)"}, manter a confiança é essencial! Se quiser garantir um método sem enrolação e acelerar sua aprovação, conte com o Manual do Aprovado — feito por quem já trilhou esse caminho.<br><br><a href="https://wa.me/SEUNUMERO" class="cta-final" target="_blank">QUERO COMEÇAR CERTO!</a>`,
        options: [
          { text: "Voltar ao início", next: 1 }
        ]
      }
    ];

    // ================= STATE E RENDER =====================
    let state = { nome: "", step: 0 }; // Salva respostas
    let history = []; // Pilha para voltar

    function renderStep(stepId) {
      const container = document.getElementById("quiz-card");
      const step = steps.find(s => s.id === stepId);
      // Barra de progresso
      updateProgressBar(stepId);

      // Avatar de apoio (personalização)
      let avatar = `<div class="avatar-float"></div>`;

      let html = avatar;

      // Pergunta simples
      let question = typeof step.question === "function" ? step.question(state) : step.question;
      html += `<div class="pergunta">${question}</div>`;

      // Campo input
      if (step.type === "input") {
        html += `<input type="text" id="input-nome" placeholder="${step.inputPlaceholder || ""}" autocomplete="off" maxlength="30"/>
          <button class="btn-quiz" id="btn-next" disabled>Avançar</button>`;
        container.innerHTML = html;
        const input = document.getElementById("input-nome");
        const btn = document.getElementById("btn-next");
        input.addEventListener("input", () => {
          btn.disabled = input.value.trim().length < 2;
        });
        btn.addEventListener("click", () => {
          history.push(stepId);
          state.nome = input.value.trim();
          state[stepId] = input.value.trim();
          goTo(step.next);
        });
        // Não mostra botão voltar no início
        return;
      }

      // Opções
      if (step.options) {
        html += `<div class="opcoes">`;
        step.options.forEach((op, idx) => {
          html += `<button class="btn-quiz" data-idx="${idx}">${op.text}</button>`;
        });
        html += `</div>`;
      }

      // Botão voltar
      if (history.length > 0) {
        html += `<button class="btn-voltar" id="btn-voltar">← Voltar</button>`;
      }
      container.innerHTML = html;

      // Listeners de opção
      if (step.options) {
        container.querySelectorAll(".btn-quiz").forEach((btn, idx) => {
          btn.addEventListener("click", () => {
            history.push(stepId);
            state[stepId] = idx;
            goTo(step.options[idx].next);
          });
        });
      }
      // Listener botão voltar
      const btnVoltar = document.getElementById("btn-voltar");
      if (btnVoltar) {
        btnVoltar.addEventListener("click", () => {
          if (history.length > 0) {
            let prev = history.pop();
            goTo(prev, true);
          }
        });
      }
    }

    function goTo(stepId, isBack = false) {
      state.step = stepId;
      // Pequena animação ao trocar
      const container = document.getElementById("quiz-card");
      container.classList.remove("show");
      setTimeout(() => {
        renderStep(stepId);
        container.classList.add("show");
      }, isBack ? 150 : 250);
    }

    function updateProgressBar(stepId) {
      // Do 0 a 9 = fluxo principal
      const total = 9;
      const percent = Math.min((stepId / total) * 100, 100);
      document.getElementById("progress-bar").style.width = percent + "%";
    }

    // Inicialização
    window.onload = () => {
      renderStep(0);
      document.getElementById("quiz-card").classList.add("show");
    };
  </script>
</body>
</html>
